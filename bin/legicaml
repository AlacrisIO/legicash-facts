#!/bin/bash -eu

here=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
top=$(dirname "$here")
build=$top/src/_build/default
legicaml=$build/legicaml.exe

if [ ! -x $legicaml ] ; then
    echo "Please run \"make toplevel\" before running $0";
    exit 0
fi

LIB=

use_lib () {
    for lib ; do
        LIB=(${LIB[@]} -I "$build/$lib/.$lib.objs" -open "${lib^}")
    done
}

echo "Starting Legicash OCaml toplevel..."
echo
use_lib legilogic_lib legilogic_ethereum legicash_lib
$legicaml "${LIB[@]}" "$@"

# TODO: make sure endpoints works by splitting library and executable initialization,
# then include it in the library mix.
